import{S as Z,i as x,s as $,e as L,c as R,a as F,d as u,b as G,g,k as U,t as y,m as A,h as S,j as T,G as k,M as ee,n as M,N as te}from"./index-ef7e113d.js";const ae={apiPassword:"password",apiUser:"administrator",apiUrl:"http://ddstaging.whirl-i-gig.com:8082/service.php",caUrl:"http://ddstaging.whirl-i-gig.com:8082",wbUrl:"https://dancing-digital.wikibase.cloud",jwtDomain:"ddstaging.whirl-i-gig.com:8082",useWikibase:!0,wikiDemoApi:"http://localhost:8000"},ie="https://query.wikidata.org/sparql",de="https://dancing-digital.wikibase.cloud/query/sparql",le="https://www.wikidata.org/w/api.php?",re=`${ae.wbUrl}/w/api.php?`;async function se(s,t){console.log(s);let e=new FormData;e.append("query",s);let l=await fetch(t==="wikidata"?ie:de,{method:"post",headers:{Accept:"application/sparql-results+json"},body:new URLSearchParams(e)});return l.ok?(await l.json()).results.bindings:[]}function j(s,t){return t[s].value.split("/")[4]}async function ne(s,t,e="en"){let i={action:"wbsearchentities",format:"json",errorformat:"plaintext",language:e,uselang:e,type:"item",search:s,origin:"*"};const n=(t==="wikidata"?le:re)+new URLSearchParams(i);return(await(await fetch(n)).json()).search}function oe(s){if(s.length==0)return[];let t=[];return s.forEach(e=>{let i;e.label?i=e.label:"aliases"in e&&(i=e.aliases[0]);let l=i,n="";e.description&&(n=e.description,l+=` (${n})`),t.push({id:e.id,label:i,search_label:l,description:n})}),t}async function Ie(s,t="wikidata",e="en"){let i=await ne(s,t,e);return oe(i)}async function J(s,t,e){let i=t.map(a=>a.split(" ").map(r=>`wdt:${r}`).join(", ")).join(", "),l=s.map(a=>`wd:${a}`).join(" "),n="";return e==="ddc"&&(n+=`
    PREFIX wd: <https://dancing-digital.wikibase.cloud/entity/>
    PREFIX wdt: <https://dancing-digital.wikibase.cloud/prop/direct/>
    `),n+=`
  SELECT DISTINCT ?prop ?propLabel ?selectedItem ?selectedItemLabel ?itemF ?itemFLabel ?itemR ?itemRLabel WHERE {
    VALUES ?selectedItem {
      ${l}
    }
    { ?selectedItem ?prop_ ?itemF. }
    UNION
    { ?itemR ?prop_ ?selectedItem. }
    ?prop wikibase:directClaim ?prop_.
    FILTER(?prop_ IN(${i}))
    SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
  }
  LIMIT 1000
  `,{data:await se(n,e),query:n}}function K(s,t=200){let e=new Set,i=[],l=[],n={},d=ce(s),a=fe(d,t);return s.filter(r=>{let o;return r.itemF!=null?o=j("itemF",r):o=j("itemR",r),a.has(o)}).forEach(r=>{let o,f,h,P,m,_=j("prop",r),E=r.propLabel.value;if(r.itemF?(m="subject",o=j("selectedItem",r),f=r.selectedItemLabel.value,h=j("itemF",r),P=r.itemFLabel.value):(m="object",o=j("itemR",r),f=r.itemRLabel.value,h=j("selectedItem",r),P=r.selectedItemLabel.value),!e.has(o)){e.add(o);let v={id:o,label:f};m=="subject"&&(v.color={background:"#00d1b2"}),i.push(v),n[o]=f}if(!e.has(h)){e.add(h);let v={id:h,label:P};m=="object"&&(v.color={background:"#00d1b2"}),i.push(v),n[h]=P}let N=`${o} ${_} ${h}`;e.has(N)||(e.add(N),l.push({from:o,to:h,propertyId:_,label:E,fromLabel:n[o],toLabel:n[h]}))}),{nodes:i,edges:l}}function ce(s){let t={};return s.forEach(e=>{let i=j("selectedItem",e);if(t[i]==null&&(t[i]={parent:null,kids:[]}),e.itemF!=null){let l=j("itemF",e);t[l]==null&&(t[l]={parent:i,kids:[]}),t[i].kids.push(l)}if(e.itemR!=null){let l=j("itemR",e);t[l]==null&&(t[l]={parent:i,kids:[]}),t[i].kids.push(l)}}),t}function fe(s,t){let e=new Set;for(let[i,l]of Object.entries(s))l.parent==null&&e.add(i),l.kids.forEach((n,d)=>{d<t&&e.add(n)});return e}async function ke(s,t,e,i,l="wikidata"){let n;for(;e>0;){let d=await J(s,t,l);n=K(d.data),n.query=d.query,n.nodes=n.nodes.filter(a=>!i.includes(a.id)),n.edges=n.edges.filter(a=>!i.includes(a.to)&&!i.includes(a.from)),s=n.nodes.map(a=>a.id),e=e-1}return n}async function ue(s,t){let e=await J([s],t),i=K(e.data);return i.query=e.query,i}let pe=[{label:"academic appointment",wikidataId:"P8413",ddcId:""},{label:"award received",wikidataId:"P166",ddcId:""},{label:"educated at",wikidataId:"P69",ddcId:""},{label:"employer",wikidataId:"P108",ddcId:""},{label:"founded by",wikidataId:"P112",ddcId:""},{label:"nominated for",wikidataId:"P1411",ddcId:""},{label:"notable works",wikidataId:"P800",ddcId:""},{label:"professorship",wikidataId:"P803",ddcId:""},{label:"student of",wikidataId:"P1066",ddcId:""},{label:"student",wikidataId:"P802",ddcId:""},{label:"work location",wikidataId:"P937",ddcId:""},{label:"winner",wikidataId:"P1346",ddcId:""}],be=[{label:"art director",wikidataId:"P3174",ddcId:"P198 P110"},{label:"cast member",wikidataId:"P161",ddcId:""},{label:"choreographer",wikidataId:"P1809",ddcId:"P116"},{label:"composer",wikidataId:"P86",ddcId:"P123 P172"},{label:"costume designer",wikidataId:"P2515",ddcId:"P127"},{label:"curator",wikidataId:"P1640",ddcId:"P128"},{label:"director",wikidataId:"P57",ddcId:"P118 P132"},{label:"director/manager",wikidataId:"P1037",ddcId:"P122 P205 P136 P182 P185"},{label:"executive producer",wikidataId:"P1431",ddcId:"P223 P164"},{label:"film editor",wikidataId:"P1040",ddcId:"P229 P190"},{label:"illustrator",wikidataId:"P110",ddcId:"P220 P156"},{label:"librettist",wikidataId:"P87",ddcId:"P145"},{label:"lighting designer",wikidataId:"P5026",ddcId:"P146"},{label:"make-up artist",wikidataId:"P4805",ddcId:"P218"},{label:"main subject",wikidataId:"P921",ddcId:""},{label:"musical conductor",wikidataId:"P3300",ddcId:"P124 P207 P152"},{label:"performer",wikidataId:"P175",ddcId:"P106 P112 P119 P129 P130 P131 P150 P154 P155 P171 P179 P187 P188 P191"},{label:"presenter",wikidataId:"P371",ddcId:"P160"},{label:"producer",wikidataId:"P162",ddcId:"P162"},{label:"production designer",wikidataId:"P2554",ddcId:""},{label:"scenographer",wikidataId:"P4608",ddcId:"P224 P170"},{label:"sound designer",wikidataId:"P5028",ddcId:"P173"},{label:"speaker",wikidataId:"P823",ddcId:"P175"},{label:"stage crew member",wikidataId:"P5802",ddcId:"P108 P109 P113 P114 P115 P125 P135 P137 P138 P139 P144 P147 P159 P161 P163 P165 P166 P167 P168 P169 P174 P176 P177 P178 P180 P181 P183 P189 P192 P193 P197"},{label:"translator",wikidataId:"P655",ddcId:"P186 P228"}],he=[{label:"location of first performance",wikidataId:"P4647",ddcId:""},{label:"part of the series",wikidataId:"P179",ddcId:"P142 P214"},{label:"production company",wikidataId:"P272",ddcId:"P121 P204"},{label:"recorded at studio or venue",wikidataId:"P483",ddcId:""},{label:"recording or performance of",wikidataId:"P2550",ddcId:"P140 P141 P213"}],ge={people:pe,roles:be,works:he};function Q(s,t,e){const i=s.slice();return i[19]=t[e],i}function V(s){let t;return{c(){t=L("div"),this.h()},l(e){t=R(e,"DIV",{class:!0}),F(t).forEach(u),this.h()},h(){G(t,"class","lds-dual-ring svelte-dt5x0l")},m(e,i){g(e,t,i)},d(e){e&&u(t)}}}function Y(s){let t,e,i,l,n,d=s[2].id&&B(s);return{c(){d&&d.c(),t=U(),e=y(s[3]),i=y(" records, "),l=y(s[4]),n=y(" relationships")},l(a){d&&d.l(a),t=A(a),e=S(a,s[3]),i=S(a," records, "),l=S(a,s[4]),n=S(a," relationships")},m(a,r){d&&d.m(a,r),g(a,t,r),g(a,e,r),g(a,i,r),g(a,l,r),g(a,n,r)},p(a,r){a[2].id?d?d.p(a,r):(d=B(a),d.c(),d.m(t.parentNode,t)):d&&(d.d(1),d=null),r&8&&T(e,a[3]),r&16&&T(l,a[4])},d(a){d&&d.d(a),a&&u(t),a&&u(e),a&&u(i),a&&u(l),a&&u(n)}}}function B(s){let t=s[2].label+"",e,i,l=s[2].id+"",n,d;return{c(){e=y(t),i=y(" ("),n=y(l),d=y("):")},l(a){e=S(a,t),i=S(a," ("),n=S(a,l),d=S(a,"):")},m(a,r){g(a,e,r),g(a,i,r),g(a,n,r),g(a,d,r)},p(a,r){r&4&&t!==(t=a[2].label+"")&&T(e,t),r&4&&l!==(l=a[2].id+"")&&T(n,l)},d(a){a&&u(e),a&&u(i),a&&u(n),a&&u(d)}}}function H(s){let t,e=s[0].edges,i=[];for(let l=0;l<e.length;l+=1)i[l]=X(Q(s,e,l));return{c(){t=L("table");for(let l=0;l<i.length;l+=1)i[l].c();this.h()},l(l){t=R(l,"TABLE",{class:!0});var n=F(t);for(let d=0;d<i.length;d+=1)i[d].l(n);n.forEach(u),this.h()},h(){G(t,"class","table svelte-dt5x0l")},m(l,n){g(l,t,n);for(let d=0;d<i.length;d+=1)i[d].m(t,null)},p(l,n){if(n&33){e=l[0].edges;let d;for(d=0;d<e.length;d+=1){const a=Q(l,e,d);i[d]?i[d].p(a,n):(i[d]=X(a),i[d].c(),i[d].m(t,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=e.length}},d(l){l&&u(t),ee(i,l)}}}function X(s){let t,e,i,l=s[19].fromLabel+"",n,d,a,r,o=s[19].label+"",f,h,P,m,_=s[19].toLabel+"",E,N,v;return{c(){t=L("tr"),e=L("td"),i=L("a"),n=y(l),a=U(),r=L("td"),f=y(o),h=U(),P=L("td"),m=L("a"),E=y(_),v=U(),this.h()},l(I){t=R(I,"TR",{});var w=F(t);e=R(w,"TD",{});var q=F(e);i=R(q,"A",{href:!0});var z=F(i);n=S(z,l),z.forEach(u),q.forEach(u),a=A(w),r=R(w,"TD",{});var c=F(r);f=S(c,o),c.forEach(u),h=A(w),P=R(w,"TD",{});var p=F(P);m=R(p,"A",{href:!0});var D=F(m);E=S(D,_),D.forEach(u),p.forEach(u),v=A(w),w.forEach(u),this.h()},h(){G(i,"href",d=s[5](s[19].from)),G(m,"href",N=s[5](s[19].to))},m(I,w){g(I,t,w),k(t,e),k(e,i),k(i,n),k(t,a),k(t,r),k(r,f),k(t,h),k(t,P),k(P,m),k(m,E),k(t,v)},p(I,w){w&1&&l!==(l=I[19].fromLabel+"")&&T(n,l),w&1&&d!==(d=I[5](I[19].from))&&G(i,"href",d),w&1&&o!==(o=I[19].label+"")&&T(f,o),w&1&&_!==(_=I[19].toLabel+"")&&T(E,_),w&1&&N!==(N=I[5](I[19].to))&&G(m,"href",N)},d(I){I&&u(t)}}}function Pe(s){let t,e,i,l,n,d=s[1]&&V(),a=s[0].nodes&&Y(s),r=s[0].edges&&H(s);return{c(){t=L("main"),d&&d.c(),e=U(),a&&a.c(),i=U(),l=L("div"),n=U(),r&&r.c(),this.h()},l(o){t=R(o,"MAIN",{class:!0});var f=F(t);d&&d.l(f),e=A(f),a&&a.l(f),i=A(f),l=R(f,"DIV",{id:!0,class:!0}),F(l).forEach(u),n=A(f),r&&r.l(f),f.forEach(u),this.h()},h(){G(l,"id","mynetwork"),G(l,"class","svelte-dt5x0l"),G(t,"class","svelte-dt5x0l")},m(o,f){g(o,t,f),d&&d.m(t,null),k(t,e),a&&a.m(t,null),k(t,i),k(t,l),k(t,n),r&&r.m(t,null)},p(o,[f]){o[1]?d||(d=V(),d.c(),d.m(t,e)):d&&(d.d(1),d=null),o[0].nodes?a?a.p(o,f):(a=Y(o),a.c(),a.m(t,i)):a&&(a.d(1),a=null),o[0].edges?r?r.p(o,f):(r=H(o),r.c(),r.m(t,null)):r&&(r.d(1),r=null)},i:M,o:M,d(o){o&&u(t),d&&d.d(),a&&a.d(),r&&r.d()}}}function me(s,t,e){let{networkData:i}=t,{graphItem:l}=t,{properties:n}=t,{resetGraphStatus:d}=t,{loading:a}=t,{newSearchStatus:r}=t,{targetWiki:o="wikidata"}=t,f={},h={},P={},m=0,_=0,E=0;const N=te();function v(c){let p=o=="wikidata"?"https://www.wikidata.org":"https://dancing-digital.wikibase.cloud";return p+="/wiki/",p+=o=="wikidata"?c:"Item:"+c,p}function I(){f={},h={},e(10,P={}),e(3,m=0)}function w(c){if(!c.nodes)return;let p="rgb(255,168,7)";e(1,a=!0);let D=[];c.nodes.forEach(b=>{b.id===l.id&&(b.color={background:p}),D.push(b)}),f=new vis.DataSet(D),h=new vis.DataSet(c.edges),f.length==0&&f.add({id:l.id,label:l.label,color:{background:p}});var C=document.getElementById("mynetwork"),O={nodes:f,edges:h},W={layout:{improvedLayout:!1},edges:{arrows:{to:{enabled:!0,type:"arrow",scaleFactor:.5}}},physics:{barnesHut:{gravitationalConstant:-3e3,damping:1,avoidOverlap:.3}},interaction:{hover:!0}};e(10,P=new vis.Network(C,O,W)),z(P)}async function q(c){let p=c.nodes[0],D=await ue(p,n),C=!1;e(6,r=!1),N("changeSearchStatus",r);let O=new Set(i.nodes.map(b=>b.id)),W=new Set(i.edges.map(b=>`${b.from} ${b.property_id} ${b.to}`));return D.nodes.forEach(b=>{O.has(b.id)||(f.add(b),e(3,m+=1),e(0,i.nodes=[...i.nodes,b],i),C=!0)}),D.edges.forEach(b=>{W.has(`${b.from} ${b.property_id} ${b.to}`)||(h.add(b),e(0,i.edges=[...i.edges,b],i),C=!0)}),C}function z(c){c.on("click",async function(p){}),c.on("doubleClick",async function(p){e(1,a=!0),await q(p)||e(1,a=!1)}),c.on("startStabilizing",function(p){e(1,a=!1)}),c.on("stabilizationProgress",function(p){e(1,a=!0)}),c.on("stabilizationIterationsDone",function(p){e(1,a=!1)}),c.on("stabilized",function(p){e(1,a=!1)}),c.on("afterDrawing",function(p,D){a&&(E+=1,E>35&&(E=0,e(1,a=!1)))})}return s.$$set=c=>{"networkData"in c&&e(0,i=c.networkData),"graphItem"in c&&e(2,l=c.graphItem),"properties"in c&&e(7,n=c.properties),"resetGraphStatus"in c&&e(8,d=c.resetGraphStatus),"loading"in c&&e(1,a=c.loading),"newSearchStatus"in c&&e(6,r=c.newSearchStatus),"targetWiki"in c&&e(9,o=c.targetWiki)},s.$$.update=()=>{s.$$.dirty&65&&r&&(I(),w(i),e(3,m=i.nodes?i.nodes.length:0),e(4,_=i.edges?i.edges.length:0)),s.$$.dirty&1280&&d&&typeof P.destroy=="function"&&(P.destroy(),I())},[i,a,l,m,_,v,r,n,d,o,P]}class _e extends Z{constructor(t){super(),x(this,t,me,Pe,$,{networkData:0,graphItem:2,properties:7,resetGraphStatus:8,loading:1,newSearchStatus:6,targetWiki:9})}}export{_e as N,ge as a,ke as g,Ie as s};
